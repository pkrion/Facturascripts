{% extends 'Master/MenuTemplate.html.twig' %}

{% block css %}
    {{ parent() }}
    <style>
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        /* Estilos Comunes */
        .badge-status { font-size: 0.75em; font-weight: 600; padding: 0.35em 0.65em; }
        .badge-activa { background-color: #e0f8f0; color: #1cc88a; }
        .badge-programada { background-color: #e6f2ff; color: #4e73df; }
        .badge-completada { background-color: #f8f9fa; color: #858796; border: 1px solid #e3e6f0; }
        .badge-pausada { background-color: #fff4e0; color: #f6c23e; }

        /* Estilos Pestaña Dashboard */
        .dashboard-stat-card .value { font-size: 2rem; font-weight: 700; }
        .dashboard-stat-card .label { font-size: 0.8rem; text-transform: uppercase; font-weight: 600; }

        .campaign-summary-item { padding: 1rem 0; border-bottom: 1px solid #e3e6f0; }
        .campaign-summary-item:last-child { border-bottom: none; }
        .campaign-summary-item .roi { font-weight: 700; font-size: 1.2rem; }

        /* Estilos Pestaña Campañas */
        .campaign-card {
            border: 1px solid #e3e6f0;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, .08);
            height: 100%;
        }
        .campaign-card .card-header { background-color: #f8f9fc; font-weight: 600; }
        .campaign-card .card-body { font-size: 0.9rem; }
        .campaign-card .metric-label { font-size: 0.8em; color: #858796; }
        .campaign-card .metric-value { font-size: 1.2em; font-weight: 700; }
        .campaign-card .budget-bar { height: 8px; }
        .campaign-card .roi-section { border-radius: 0.35rem; text-align: center; padding: 0.75rem; }
        .campaign-card .roi-section .metric-value { font-size: 1.75em; }
        .campaign-card .sub-metrics { text-align: center; }

        /* Estilos Pestaña Automatización */
        .automation-item {
            display: flex;
            align-items: center;
            padding: 1.5rem 1rem;
            border: 1px solid #e3e6f0;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            background-color: #fff;
        }
        .automation-title { font-weight: 600; font-size: 1.1rem; }
        .automation-trigger { font-size: 0.9rem; color: #858796; }
        .automation-metrics {
            display: flex;
            flex-grow: 1;
            justify-content: flex-end;
            gap: 3rem;
            text-align: center;
        }
        .automation-metrics .metric-value { font-size: 1.25rem; font-weight: 700; }
        .automation-metrics .metric-label { font-size: 0.8rem; color: #858796; }
    </style>
{% endblock %}

{% block body %}
<div class="container-fluid">

    <div class="page-header">
        <div>
            <h1 class="h3 mb-1 text-gray-800">Marketing Digital</h1>
            <p class="text-muted mb-0">Gestiona tus campañas y automatizaciones</p>
        </div>
        <div>
            <div class="btn-group me-2" role="group">
                <a href="#" class="btn btn-sm btn-outline-primary active" data-bs-toggle="tab" data-bs-target="#dashboard-tab">Dashboard</a>
                <a href="#" class="btn btn-sm btn-outline-primary" data-bs-toggle="tab" data-bs-target="#campaigns-tab">Campañas</a>
                <a href="#" class="btn btn-sm btn-outline-primary" data-bs-toggle="tab" data-bs-target="#automations-tab">Automatización</a>
            </div>
            <button class="btn btn-primary"><i class="fas fa-plus fa-fw me-2"></i>Nueva Campaña</button>
        </div>
    </div>
    
    <div class="tab-content mt-3">

        <div class="tab-pane fade show active" id="dashboard-tab" role="tabpanel">
            <div class="row">
                <div class="col-md-3"><div class="card card-body text-center dashboard-stat-card mb-4"><div class="value">89,900</div><div class="label text-muted">Emails Enviados</div></div></div>
                <div class="col-md-3"><div class="card card-body text-center dashboard-stat-card mb-4"><div class="value text-success">33.0%</div><div class="label text-muted">Tasa Apertura</div></div></div>
                <div class="col-md-3"><div class="card card-body text-center dashboard-stat-card mb-4"><div class="value text-warning">6.6%</div><div class="label text-muted">Tasa Click</div></div></div>
                <div class="col-md-3"><div class="card card-body text-center dashboard-stat-card mb-4"><div class="value text-primary">€45,600</div><div class="label text-muted">Revenue Generado</div></div></div>
            </div>
            <div class="row">
                <div class="col-lg-8 mb-4"><div class="card shadow"><div class="card-header">Rendimiento de Campañas</div><div class="card-body"><canvas id="rendimientoChart"></canvas></div></div></div>
                <div class="col-lg-4 mb-4"><div class="card shadow"><div class="card-header">Fuentes de Leads</div><div class="card-body"><canvas id="fuentesChart"></canvas></div></div></div>
            </div>
            <div class="row">
                <div class="col-12"><div class="card shadow"><div class="card-header">Campañas Activas</div><div class="card-body">
                    <div class="d-flex justify-content-between align-items-center campaign-summary-item">
                        <div>
                            <h6 class="mb-0">Lanzamiento Producto Q2</h6>
                            <small class="text-muted">Audiencia: 5400 contactos</small>
                        </div>
                        <div class="text-end me-5"><h6 class="mb-0">234</h6><small class="text-muted">Conversiones</small></div>
                        <div class="text-end"><h6 class="mb-0 text-success roi">285%</h6><small class="text-muted">ROI</small></div>
                        <span class="badge rounded-pill badge-status badge-activa">activa</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center campaign-summary-item">
                        <div>
                            <h6 class="mb-0">Retargeting Web Visitors</h6>
                            <small class="text-muted">Audiencia: 12.500 contactos</small>
                        </div>
                        <div class="text-end me-5"><h6 class="mb-0">187</h6><small class="text-muted">Conversiones</small></div>
                        <div class="text-end"><h6 class="mb-0 text-success roi">156%</h6><small class="text-muted">ROI</small></div>
                        <span class="badge rounded-pill badge-status badge-activa">activa</span>
                    </div>
                </div></div></div>
            </div>
        </div>

        <div class="tab-pane fade" id="campaigns-tab" role="tabpanel">
            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="card campaign-card">
                        <div class="card-header d-flex justify-content-between">
                            <span><i class="fas fa-rocket me-2"></i>Lanzamiento Producto Q2</span>
                            <span class="badge rounded-pill badge-status badge-activa">activa</span>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between mb-3">
                                <div><div class="metric-label">Audiencia</div><div class="metric-value">5400</div></div>
                                <div><div class="metric-label">Conversiones</div><div class="metric-value">234</div></div>
                            </div>
                            <div class="mb-3">
                                <div class="metric-label d-flex justify-content-between"><span>Presupuesto</span><span>6200,00 € / 8500,00 €</span></div>
                                <div class="progress budget-bar"><div class="progress-bar bg-primary" role="progressbar" style="width: 73%;"></div></div>
                            </div>
                            <div class="roi-section bg-light-success text-success">
                                <div class="metric-label">ROI</div>
                                <div class="metric-value">285%</div>
                            </div>
                        </div>
                        <div class="card-footer sub-metrics d-flex justify-content-around">
                            <div><div class="metric-value">18.200</div><div class="metric-label">Enviados</div></div>
                            <div><div class="metric-value">33.0%</div><div class="metric-label">Apertura</div></div>
                            <div><div class="metric-value">20.0%</div><div class="metric-label">Click</div></div>
                        </div>
                    </div>
                </div>
                 <div class="col-lg-6 mb-4">
                    <div class="card campaign-card">
                        <div class="card-header d-flex justify-content-between">
                            <span><i class="fas fa-bullseye me-2"></i>Retargeting Web Visitors</span>
                            <span class="badge rounded-pill badge-status badge-activa">activa</span>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between mb-3">
                                <div><div class="metric-label">Audiencia</div><div class="metric-value">12.500</div></div>
                                <div><div class="metric-label">Conversiones</div><div class="metric-value">187</div></div>
                            </div>
                            <div class="mb-3">
                                <div class="metric-label d-flex justify-content-between"><span>Presupuesto</span><span>3800,00 € / 5000,00 €</span></div>
                                <div class="progress budget-bar"><div class="progress-bar bg-primary" role="progressbar" style="width: 76%;"></div></div>
                            </div>
                            <div class="roi-section bg-light-success text-success">
                                <div class="metric-label">ROI</div>
                                <div class="metric-value">156%</div>
                            </div>
                        </div>
                        <div class="card-footer sub-metrics d-flex justify-content-around">
                            <div><div class="metric-value">125.000</div><div class="metric-label">Impresiones</div></div>
                            <div><div class="metric-value">2500</div><div class="metric-label">Clicks</div></div>
                            <div><div class="metric-value">2.0%</div><div class="metric-label">CTR</div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="automations-tab" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-robot me-2"></i>Automatizaciones de Marketing
                </div>
                <div class="card-body">
                    <div class="automation-item">
                        <div class="me-4">
                            <div class="automation-title">Bienvenida Nuevos Leads</div>
                            <div class="automation-trigger">Trigger: Registro formulario</div>
                        </div>
                        <div class="automation-metrics">
                            <div><div class="metric-value">5</div><div class="metric-label">Emails en secuencia</div></div>
                            <div><div class="metric-value">1250</div><div class="metric-label">Contactos activos</div></div>
                            <div class="text-success"><div class="metric-value">60%</div><div class="metric-label">Tasa apertura</div></div>
                            <div class="text-success"><div class="metric-value">12%</div><div class="metric-label">Tasa click</div></div>
                            <div><div class="metric-value">89</div><div class="metric-label">Conversiones</div></div>
                        </div>
                        <span class="badge rounded-pill badge-status badge-activa ms-4">activa</span>
                    </div>
                     <div class="automation-item">
                        <div class="me-4">
                            <div class="automation-title">Abandono Carrito</div>
                            <div class="automation-trigger">Trigger: Carrito abandonado</div>
                        </div>
                        <div class="automation-metrics">
                            <div><div class="metric-value">3</div><div class="metric-label">Emails en secuencia</div></div>
                            <div><div class="metric-value">890</div><div class="metric-label">Contactos activos</div></div>
                            <div class="text-success"><div class="metric-value">45%</div><div class="metric-label">Tasa apertura</div></div>
                            <div class="text-warning"><div class="metric-value">8%</div><div class="metric-label">Tasa click</div></div>
                            <div><div class="metric-value">156</div><div class="metric-label">Conversiones</div></div>
                        </div>
                        <span class="badge rounded-pill badge-status badge-activa ms-4">activa</span>
                    </div>
                     <div class="automation-item">
                        <div class="me-4">
                            <div class="automation-title">Reactivación Clientes</div>
                            <div class="automation-trigger">Trigger: Sin actividad 90 días</div>
                        </div>
                        <div class="automation-metrics">
                            <div><div class="metric-value">4</div><div class="metric-label">Emails en secuencia</div></div>
                            <div><div class="metric-value">567</div><div class="metric-label">Contactos activos</div></div>
                            <div class="text-warning"><div class="metric-value">32%</div><div class="metric-label">Tasa apertura</div></div>
                            <div class="text-danger"><div class="metric-value">5%</div><div class="metric-label">Tasa click</div></div>
                            <div><div class="metric-value">23</div><div class="metric-label">Conversiones</div></div>
                        </div>
                        <span class="badge rounded-pill badge-status badge-pausada ms-4">pausada</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // --- GRÁFICA DE RENDIMIENTO (LÍNEAS) ---
        const ctxRendimiento = document.getElementById('rendimientoChart')?.getContext('2d');
        if(ctxRendimiento) {
            new Chart(ctxRendimiento, {
                type: 'line',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                    datasets: [
                        { label: 'Emails Enviados', data: [4000, 4800, 4200, 5200, 4800, 5500], borderColor: '#4e73df', tension: 0.3, fill: false },
                        { label: 'Aperturas', data: [1200, 1500, 1300, 1800, 1600, 1900], borderColor: '#1cc88a', tension: 0.3, fill: false },
                        { label: 'Clicks', data: [240, 300, 260, 360, 320, 380], borderColor: '#f6c23e', tension: 0.3, fill: false }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        // --- GRÁFICA DE FUENTES (PIE) ---
        const ctxFuentes = document.getElementById('fuentesChart')?.getContext('2d');
        if(ctxFuentes) {
            new Chart(ctxFuentes, {
                type: 'pie',
                data: {
                    labels: ['Email Marketing', 'Redes Sociales', 'Google Ads', 'Referidos', 'Orgánico'],
                    datasets: [{
                        data: [35, 25, 20, 15, 5],
                        backgroundColor: ['#4e73df', '#36b9cc', '#f6c23e', '#1cc88a', '#8e44ad']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }
    });
</script>
{% endblock %}